<mat-toolbar class="view-header mat-elevation-z1">
  <span class="title">{{documentType?.folder | uppercase}} \
    <strong> {{documentType?.name | uppercase}}: {{ vm?.displayName | uppercase }}</strong>
  </span>
  <!-- This fills the remaining space of the current row -->
  <span class="app-toolbar-filler"></span>
  <button *ngIf="!isnew()" (click)="togglePanel()" mat-icon-button>
    <mat-icon>info_outline</mat-icon>
  </button>
  <span class="app-toolbar-right-filler"></span>
</mat-toolbar>


<div class="view-content">
  <div fxLayout="row">
    <div fxFlex>
      <form type="submit" #companyForm="ngForm">
        <mat-card class="form-card">
          <mat-card-title>
            <label class="small">
              <strong>{{documentType?.name | uppercase}} {{vm?.displayName}}</strong>
            </label>
            <span class="app-toolbar-filler"></span>
            <button *ngIf='readonly' color="primary" (click)="toggle_edit_mode()" mat-mini-fab>
              <mat-icon class="form-button-icon">edit</mat-icon>
            </button>
            <button *ngIf='!readonly' (click)="save()" mat-button color="primary">
              <label class="small">ΑΠΟΘΗΚΕΥΣΗ</label>
            </button>
            <button *ngIf='!readonly' (click)="cancel()" mat-button color="warn">
              <label class="small">ΑΚΥΡΩΣΗ</label>
            </button>
          </mat-card-title>

          <mat-card-title class="short">
            <label class="small">ΠΕΛΑΤΗΣ</label>
            <span class="app-toolbar-filler"></span>
          </mat-card-title>

          <mat-card-content class="short">
            <div class="form-container">
              <mat-form-field floatPlaceholder='never' class="short" *ngIf='!readonly'>
                <mat-icon matPrefix class="search-icon">search</mat-icon>
                <input mat-input [formControl]="searchCompanyControl" name="filter" matInput type="text" placeholder="αναζήτηση επιχείρησης"
                  maxlength="300" [matAutocomplete]="autocompany">

                <mat-autocomplete #autocompany="matAutocomplete" (optionSelected)="companyChanged($event)" [displayWith]="displayFn">
                  <mat-option *ngFor="let company of filteredcompanies" [value]="company">
                    <label class="small">{{ company.name }}</label>
                    <small>{{ company.legalName }}</small>
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
              <br>
              <label *ngIf='!editcompany'>{{company.legalName}}</label>
              <mat-form-field *ngIf='editcompany' floatPlaceholder='never' class="short">
                <input class="short" matInput [readonly]='readonly' #name="ngModel" name="name" [(ngModel)]='company.legalName' placeholder="Επωνυμία επιχείρισης"
                  maxlength="150">
              </mat-form-field>

              <label *ngIf='!editcompany'>{{company.taxCode}}</label>
              <mat-form-field *ngIf='editcompany' class="short" floatPlaceholder='never'>
                <input matInput [readonly]='readonly' #taxcode="ngModel" name="taxcode" [(ngModel)]='company.taxCode' placeholder="ΑΦΜ" floatPlaceholder='auto'
                  maxlength="50">
              </mat-form-field>

              <label *ngIf='!editcompany'>{{company.taxOffice}}</label>
              <mat-form-field *ngIf='editcompany' class="short" floatPlaceholder='never'>
                <input matInput [readonly]='readonly' #taxoffice="ngModel" name="taxoffice" [(ngModel)]='company.taxOffice' placeholder="ΔΟΥ"
                  floatPlaceholder='auto' maxlength="150">
              </mat-form-field>

              <label *ngIf='!editcompany'>{{company.lineOfBusiness}}</label>
              <mat-form-field *ngIf='editcompany' class="short" floatPlaceholder='never'>
                <input matInput [readonly]='readonly' #lineofbusiness="ngModel" name="lineofbusiness" [(ngModel)]='company.lineOfBusiness'
                  placeholder="Επάγγελμα, δραστηριότητα" floatPlaceholder='auto' maxlength="150">
              </mat-form-field>

              <label *ngIf='!editcompany'>{{company.address.name}}</label>
              <mat-form-field *ngIf='editcompany' class="short" floatPlaceholder='never'>
                <input matInput [readonly]='readonly' #address1="ngModel" name="address1" [(ngModel)]='company.address.name' placeholder="Διεύθυνση #1"
                  floatPlaceholder='auto' maxlength="150">
              </mat-form-field>

              <label *ngIf='!editcompany'>{{company.address.zipCode}}</label>
              <mat-form-field *ngIf='editcompany' class="small" floatPlaceholder='never'>
                <input matInput [readonly]='readonly' #zipCode="ngModel" name="zipCode" [(ngModel)]='company.address.zipCode' placeholder="ΤΚ"
                  floatPlaceholder='auto' maxlength="150">
              </mat-form-field>

              <label *ngIf='!editcompany'>{{company.address.city}}</label>
              <mat-form-field *ngIf='editcompany' class="short" floatPlaceholder='never'>
                <input matInput [readonly]='readonly' #city="ngModel" name="city" [(ngModel)]='company.address.city' placeholder="Πόλη" floatPlaceholder='auto'
                  maxlength="150">
              </mat-form-field>

              <label *ngIf='!editcompany'>{{company.address.countryCode}}</label>
              <mat-form-field *ngIf='editcompany' class="short" floatPlaceholder='auto' name="country" #country>
                <mat-select [disabled]='readonly' name="country" #currency="ngModel" [(ngModel)]='company.address.countryCode' placeholder="Χώρα">
                </mat-select>
              </mat-form-field>
            </div>
          </mat-card-content>

          <mat-card-title>
            <label class="small inline">ΠΡΟΪΟΝΤΑ \ ΥΠΗΡΕΣΙΕΣ</label>
          </mat-card-title>
          <mat-card-content>
            <div class="form-container">
              <label *ngIf="readonly && (!model.lines || model.lines.length==0)">Δεν έχουν οριστεί προιόντα ή υπηρεσίες</label>
              <ng-container>
                <div class="line-container" [ngClass]="{'even':isEven(i)}" fxLayout="row" fxLayoutAlign="start start" *ngFor="let line of model?.lines; let i = index">
                  <div fxFlexAlign="center center" fxFlex="30px">
                    <label>{{i+1}}</label>
                  </div>
                  <!-- main info - separated in to two lines -->
                  <!-- line 1 is product lookup and line 2 is the description and taxes ? -->
                  <div fxFlex fxLayout="column" fxLayoutAlign="space-between none">
                    <!-- line 1 -->
                    <div fxLayout="row" fxLayoutAlign="start start">
                      <mat-form-field fxFlex="70" class="list" floatPlaceholder='auto'>
                        <mat-icon *ngIf="!readonly" matPrefix class="search-icon">search</mat-icon>
                        <input [readonly]="readonly" matInput #lineproductname="ngModel" name="lineproductname-{{i}}" [(ngModel)]='line.product.name'
                          placeholder="προϊόν ή υπηρεσία">
                      </mat-form-field>

                      <mat-form-field fxFlex="20" class="list" floatPlaceholder='auto'>
                        <input matInput [readonly]="readonly" type="number" #lineunitAmount="ngModel" name="lineunitAmount-{{i}}" [(ngModel)]='line.unitAmount'
                          placeholder="αξία">
                        <span matSuffix class="extrasmall">{{model.currencyCode}}</span>
                      </mat-form-field>

                      <mat-form-field fxFlex="10" class="list" floatPlaceholder='auto'>
                        <input matInput [readonly]="readonly" type="number" #linequantity="ngModel" name="linequantity-{{i}}" [(ngModel)]='line.quantity'
                          placeholder="ποσότητα">
                      </mat-form-field>

                      <mat-form-field fxFlex="10" class="list" floatPlaceholder='auto'>
                        <input matInput [readonly]="readonly" type="number" #linediscount="ngModel" name="linediscount-{{i}}" [(ngModel)]='line.discountRate'
                          placeholder="έκπτωση">
                      </mat-form-field>
                    </div>
                    <!-- line 2 -->
                    <div fxLayout="row" fxLayoutAlign="start start">
                      <mat-form-field fxFlex class="list" floatPlaceholder='auto'>
                        <textarea [readonly]="readonly" matTextareaAutosize matAutosizeMinRows="2" matAutosizeMaxRows="5" matInput #linedescription="ngModel"
                          name="linedescription-{{i}}" [(ngModel)]='line.description' placeholder="περιγραφή" maxlength="500"></textarea>
                        <mat-hint *ngIf="!readonly" align="end">{{line.description?.length || 0}}/500</mat-hint>
                      </mat-form-field>
                    </div>
                  </div>

                  <!-- totals / subtotals -->
                  <div fxFlex="120px">
                    <span fxFlex class="total-header">ΣΥΝΟΛΟ</span>
                  </div>

                  <!-- actions - delete - duplicate -->
                  <div *ngIf="!readonly" fxFlex="40px" fxFlexAlign="center">
                    <button color="default" (click)="removeline(i)" mat-mini-fab class="xsmall">
                      <!-- <mat-icon>delete_forever</mat-icon> -->
                    </button>
                  </div>
                </div>
                <mat-divider *ngIf="(model.lines && model.lines.length>0)"></mat-divider>
                <!-- subTotal LINE -->
                <div class="line-container-total" *ngIf="(model.lines && model.lines.length>0)">
                  <div fxFlex="30px"></div>
                  <div fxFlex>SUB TOTAL</div>
                  <div fxFlex="120px">
                    <span fxFlex class="total">{{model.subTotal | currency:model.currencyCode}}</span>
                  </div>
                  <div *ngIf="!readonly" fxFlex="40px"></div>
                </div>
                <!-- totalSalesTax LINE -->
                <div class="line-container-total" *ngIf="(model.lines && model.lines.length>0)">
                  <div fxFlex="30px"></div>
                  <div fxFlex>TOTAL SALES TAX</div>
                  <div fxFlex="120px">
                    <span fxFlex class="total">{{model.totalSalesTax | currency:model.currencyCode}}</span>
                  </div>
                  <div *ngIf="!readonly" fxFlex="40px"></div>
                </div>
                <!-- totalTax LINE -->
                <div class="line-container-total" *ngIf="(model.lines && model.lines.length>0)">
                  <div fxFlex="30px"></div>
                  <div fxFlex>TOTAL TAX</div>
                  <div fxFlex="120px">
                    <span fxFlex class="total">{{model.totalTax | currency:model.currencyCode}}</span>
                  </div>
                  <div *ngIf="!readonly" fxFlex="40px"></div>
                </div>
                <!-- total LINE -->
                <div class="line-container-total" *ngIf="(model.lines && model.lines.length>0)">
                  <div fxFlex="30px"></div>
                  <div fxFlex>TOTAL</div>
                  <div fxFlex="120px">
                    <span fxFlex class="grand-total">
                      <strong>{{model.total | currency:model.currencyCode}}</strong>
                    </span>
                  </div>
                  <div *ngIf="!readonly" fxFlex="40px"></div>
                </div>
                <!-- totalPayable LINE -->
                <div class="line-container-total" *ngIf="(model.lines && model.lines.length>0)">
                  <div fxFlex="30px"></div>
                  <div fxFlex>TOTAL PAYABLE</div>
                  <div fxFlex="120px">
                    <span fxFlex class="total">{{model.totalPayable | currency:model.currencyCode}}</span>
                  </div>
                  <div *ngIf="!readonly" fxFlex="40px"></div>
                </div>
              </ng-container>
            </div>
          </mat-card-content>
        </mat-card>
      </form>
    </div>
    <div fxFlex="360px" fxLayoutAlign="start stretch" fxShow fxHide.lt-md class="doc-info-panel" *ngIf="showPane">
      lalala
    </div>
  </div>
</div>
